<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√â VUI S√ÅNG T·∫†O - KI·∫æN TR√öC S∆Ø NH√ç</title>
    <meta name="author" content="TR·∫¶N H·ªíNG LOAN"> 
    <style>
        :root {
            --primary-color: #FF9800;
            --secondary-color: #00796B;
            --bg-color: #E0F7FA;
            --zone-bg: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            background-image: url('nen.jpg'); 
            background-size: cover;
            background-position: center;
            user-select: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* --- Header Ch√≠nh --- */
        #main-header {
            width: 100%;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 50;
            border-bottom: 3px solid var(--primary-color);
            flex-shrink: 0;
        }

        .game-title {
            color: var(--primary-color);
            font-size: 1.6rem;
            font-weight: 900;
            margin: 0;
            text-transform: uppercase;
            text-shadow: 1px 1px 0px #ffe0b2;
        }

        .author-name {
            color: var(--secondary-color);
            font-size: 0.9rem;
            font-weight: 600;
            margin: 2px 0 0 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- N√∫t nh·∫°c --- */
        #music-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 100;
            background-color: #ffffff;
            border: 2px solid #FF9800;
            color: #FF9800;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #music-btn.playing {
            background-color: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        /* --- Robot Bo --- */
        #header-area {
            width: 95%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.85);
            padding: 5px 15px;
            display: flex;
            align-items: center;
            border-radius: 15px;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .robot-avatar {
            font-size: 2.5rem;
            margin-right: 15px;
            animation: bounce 2s infinite;
        }

        .robot-dialogue {
            font-size: 1.1rem;
            color: #333;
            font-weight: 600;
        }

        .talking { color: #e65100; }

        /* --- Game Info --- */
        #info-bar {
            width: 95%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            margin: 5px 0;
            font-weight: bold;
            color: #00796B;
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
            flex-shrink: 0;
        }

        /* --- Game Container --- */
        #game-container {
            display: flex;
            flex-direction: column;
            width: 98%;
            max-width: 1200px;
            flex-grow: 1;
            gap: 10px;
            padding-bottom: 10px;
            overflow-y: auto;
            justify-content: space-evenly; /* CƒÉn ƒë·ªÅu kh√¥ng gian d·ªçc */
        }

        /* KHU V·ª∞C V·∫¨T TH·ªÇ (ITEMS) - TƒÇNG K√çCH TH∆Ø·ªöC */
        #items-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng n·∫øu m√†n h√¨nh b√© */
            gap: 20px; /* Kho·∫£ng c√°ch r·ªông h∆°n */
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
            min-height: 140px; /* TƒÉng chi·ªÅu cao */
            align-items: center;
            border: 2px solid #fff;
        }

        .draggable {
            width: 110px; /* TƒÉng t·ª´ 80px l√™n 110px */
            height: 120px; /* TƒÉng t·ª´ 90px l√™n 120px */
            cursor: grab;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-size: 0.9rem; font-weight: bold; text-align: center;
            background: white; border-radius: 15px;
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
            transition: transform 0.2s; user-select: none; padding: 5px;
        }

        .draggable img {
            width: 80px; /* TƒÉng ·∫£nh to h∆°n */
            height: 80px;
            margin-bottom: 5px; pointer-events: none; object-fit: contain;
        }

        .draggable:active { transform: scale(1.1); cursor: grabbing; }

        /* KHU V·ª∞C GI·ªé (ZONES) */
        #zones-row {
            display: flex; /* ƒê·ªïi sang Flex ƒë·ªÉ linh ho·∫°t s·ªë l∆∞·ª£ng c·ªôt */
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            flex-grow: 1;
            align-items: center;
        }

        .drop-zone {
            background-color: var(--zone-bg);
            border: 3px dashed #B0BEC5;
            border-radius: 20px;
            display: flex; flex-direction: column;
            align-items: center; padding: 10px;
            transition: all 0.3s; position: relative; justify-content: center;
            width: 130px; /* ƒê·ªãnh k√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh cho gi·ªè */
            height: 140px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }

        .drop-zone.active-zone {
            border-color: var(--primary-color);
            background-color: #FFF3E0;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);
        }

        .zone-title { font-size: 1rem; font-weight: bold; color: #555; margin-bottom: 8px; pointer-events: none; }
        .zone-icon-img { width: 70px; height: 70px; opacity: 0.8; object-fit: contain; }

        /* --- Modal --- */
        #level-complete-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center;
            z-index: 200;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 20px;
            text-align: center; animation: popIn 0.4s; max-width: 90%;
            border: 6px solid var(--primary-color);
        }
        .btn {
            background: #4CAF50; color: white; border: none;
            padding: 15px 30px; font-size: 1.3rem; border-radius: 40px;
            cursor: pointer; margin: 10px; box-shadow: 0 5px 0 #388E3C;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-restart { background: #FF5722; box-shadow: 0 5px 0 #D84315; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        
        /* Mobile Responsive */
        @media (max-width: 600px) {
            .game-title { font-size: 1.1rem; }
            .robot-avatar { font-size: 2rem; }
            .draggable { width: 70px; height: 80px; font-size: 0.7rem; }
            .draggable img { width: 45px; height: 45px; }
            .drop-zone { width: 80px; height: 90px; }
            .zone-icon-img { width: 40px; height: 40px; }
            .zone-title { font-size: 0.7rem; }
            #items-row { gap: 10px; min-height: 100px; }
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="music.mp3" type="audio/mpeg"></audio>
    <audio id="robot-voice"></audio>
    <button id="music-btn" onclick="toggleMusic()">üîá B·∫≠t Nh·∫°c</button>

    <div id="main-header">
        <h1 class="game-title">B√â VUI S√ÅNG T·∫†O C√ôNG NH·ªÆNG H√åNH ƒê√ÅNG Y√äU</h1>
        <h3 class="author-name">Ng∆∞·ªùi th·ª±c hi·ªán: TR·∫¶N H·ªíNG LOAN</h3>
    </div>

    <div id="header-area">
        <div class="robot-avatar">ü§ñ</div>
        <div class="robot-dialogue" id="robot-text">B√≠p b√≠p! ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <div id="info-bar">
        <span id="level-indicator">M√†n 1/3</span>
        <span id="score-indicator">Ti·∫øn ƒë·ªô: 0/4</span>
    </div>

    <div id="game-container">
        <div id="zones-row"></div>
        <div id="items-row"></div>
    </div>

    <div id="level-complete-modal">
        <div class="modal-content">
            <h2 id="modal-title">Ho√†n th√†nh!</h2>
            <p id="modal-msg" style="font-size: 1.2rem;">B·∫°n l√†m t·ªët l·∫Øm!</p>
            <div>
                <button class="btn btn-restart" onclick="restartLevel()">Ch∆°i l·∫°i ‚Ü∫</button>
                <button class="btn" id="next-btn" onclick="nextLevel()">M√†n ti·∫øp theo ‚ûî</button>
            </div>
        </div>
    </div>

    <script>
        // --- √ÇM THANH ---
        const bgMusic = document.getElementById('bg-music');
        const robotVoice = document.getElementById('robot-voice');
        const musicBtn = document.getElementById('music-btn');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicBtn.innerHTML = "üîá B·∫≠t Nh·∫°c";
                musicBtn.classList.remove('playing');
                isMusicPlaying = false;
            } else {
                bgMusic.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c"));
                musicBtn.innerHTML = "üéµ T·∫Øt Nh·∫°c";
                musicBtn.classList.add('playing');
                isMusicPlaying = true;
            }
        }

        function playRobot(src) {
            robotVoice.src = src;
            if (isMusicPlaying) bgMusic.volume = 0.3;
            robotVoice.play().then(() => {
                document.getElementById('robot-text').classList.add('talking');
            }).catch(() => {});
            robotVoice.onended = () => {
                if (isMusicPlaying) bgMusic.volume = 1.0;
                document.getElementById('robot-text').classList.remove('talking');
            };
        }

        document.body.addEventListener('click', function() {
            if (!isMusicPlaying) {
                bgMusic.play().then(() => {
                    musicBtn.innerHTML = "üéµ T·∫Øt Nh·∫°c";
                    musicBtn.classList.add('playing');
                    isMusicPlaying = true;
                }).catch(() => {});
            }
        }, { once: true });

        // --- C·∫§U H√åNH D·ªÆ LI·ªÜU GAME (ƒê√£ th√™m Kh·ªëi Tam Gi√°c) ---
        const gameData = [
            {
                level: 1,
                title: "Kh·ªüi ƒë·ªông: Tr√≤n & Vu√¥ng",
                introText: "Ch√†o b√©! H√£y t√¨m gi√∫p t·ªõ Qu·∫£ Tr√≤n v√† H·ªôp Vu√¥ng nh√©!",
                introAudio: "c1a.wav",
                successText: "Gi·ªèi qu√°! B√© ƒë√£ ph√¢n bi·ªát ƒë∆∞·ª£c Tr√≤n v√† Vu√¥ng r·ªìi!",
                successAudio: "c1b.wav",
                types: ['sphere', 'cube'],
                items: [
                    { id: 'i1', name: 'Qu·∫£ Cam', type: 'sphere', img: 'cam.jpg' },
                    { id: 'i2', name: 'H·ªôp Qu√†', type: 'cube', img: 'hopqua.png' },
                    { id: 'i3', name: 'B√≥ng ƒê√°', type: 'sphere', img: 'bong.jpg' },
                    { id: 'i4', name: 'Rubik', type: 'cube', img: 'rubik.jpg' }
                ]
            },
            {
                level: 2,
                title: "TƒÉng t·ªëc: Tr·ª•, Ch·ªØ Nh·∫≠t & Tam Gi√°c",
                introText: "M√†n 2: H√£y t√¨m Lon N∆∞·ªõc, H·ªôp S·ªØa v√† c·∫£ Kim T·ª± Th√°p (Tam gi√°c) n·ªØa nh√©!",
                introAudio: "c2a.wav",
                successText: "Hoan h√¥! B√© th·∫≠t tinh m·∫Øt!",
                successAudio: "c2b.wav",
                // Th√™m 'pyramid' v√†o m√†n 2
                types: ['cylinder', 'rect', 'pyramid'],
                items: [
                    { id: 'i5', name: 'Lon N∆∞·ªõc', type: 'cylinder', img: 'lonnuoc.jpg' },
                    { id: 'i6', name: 'H·ªôp S·ªØa', type: 'rect', img: 'hopsua.png' },
                    { id: 'i7', name: 'Kim T·ª± Th√°p', type: 'pyramid', img: 'kimtuthap.jpg' }, /* ·∫¢nh m·ªõi */
                    { id: 'i8', name: 'Quy·ªÉn S√°ch', type: 'rect', img: 'sach.jpg' },
                    { id: 'i9', name: 'Kh·ªëi G·ªó', type: 'pyramid', img: 'khoitamgiac.jpg' } /* ·∫¢nh m·ªõi */
                ]
            },
            {
                level: 3,
                title: "Th·ª≠ th√°ch: T·ªïng h·ª£p 5 lo·∫°i",
                introText: "Th·ª≠ th√°ch cu·ªëi c√πng: H√£y d·ªçn d·∫πp t·∫•t c·∫£ ƒë·ªì v·∫≠t, c·∫£ ƒê·ªânh Fansipan n·ªØa nh√©!",
                introAudio: "c3a.wav",
                successText: "Tuy·ªát ƒë·ªânh! B√© l√† Ki·∫øn tr√∫c s∆∞ t√†i ba nh·∫•t qu·∫£ ƒë·∫•t!",
                successAudio: "c3b.wav",
                // Th·ª≠ th√°ch 5 lo·∫°i h√¨nh kh·ªëi
                types: ['sphere', 'cylinder', 'cube', 'rect', 'pyramid'],
                items: [
                    { id: 'i1', name: 'Qu·∫£ Cam', type: 'sphere', img: 'cam.jpg' },
                    { id: 'i5', name: 'Lon N∆∞·ªõc', type: 'cylinder', img: 'lonnuoc.jpg' },
                    { id: 'i2', name: 'H·ªôp Qu√†', type: 'cube', img: 'hopqua.png' },
                    { id: 'i6', name: 'H·ªôp S·ªØa', type: 'rect', img: 'hopsua.png' },
                    { id: 'i10', name: 'ƒê·ªânh Fansipan', type: 'pyramid', img: 'hinh_chop_tu_giac_deu_6_b40c372f0a.png' }, /* ·∫¢nh m·ªõi */
                    { id: 'i11', name: 'ƒê·ªãa C·∫ßu', type: 'sphere', img: 'qua.jpg' }
                ]
            }
        ];

        // ƒê·ªãnh nghƒ©a hi·ªÉn th·ªã Gi·ªè h√†ng
        // L∆∞u √Ω: T√¥i d√πng ·∫£nh 'khoitamgiac.jpg' l√†m bi·ªÉu t∆∞·ª£ng cho gi·ªè Tam Gi√°c
        const zoneDefinitions = {
            'sphere': { label: 'Kh·ªëi C·∫ßu', icon: 'khoitron.png' },
            'cube': { label: 'L·∫≠p Ph∆∞∆°ng', icon: 'khoivuong.png' },
            'cylinder': { label: 'Kh·ªëi Tr·ª•', icon: 'khoitru.png' },
            'rect': { label: 'Ch·ªØ Nh·∫≠t', icon: 'khoichunhat.png' },
            'pyramid': { label: 'Tam Gi√°c', icon: 'khoitamgiac.jpg' } /* M·ªõi */
        };

        // --- LOGIC GAME ---
        let currentLevelIndex = 0;
        let correctCount = 0;
        let totalItems = 0;

        const robotText = document.getElementById('robot-text');
        const levelIndicator = document.getElementById('level-indicator');
        const scoreIndicator = document.getElementById('score-indicator');
        const zonesRow = document.getElementById('zones-row');
        const itemsRow = document.getElementById('items-row');
        const modal = document.getElementById('level-complete-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMsg = document.getElementById('modal-msg');
        const nextBtn = document.getElementById('next-btn');

        window.onload = () => loadLevel(0);

        function loadLevel(index) {
            currentLevelIndex = index;
            const levelData = gameData[index];
            correctCount = 0;
            totalItems = levelData.items.length;
            modal.style.display = 'none';
            
            levelIndicator.textContent = `M√†n ${index + 1}: ${levelData.title}`;
            scoreIndicator.textContent = `Ti·∫øn ƒë·ªô: 0/${totalItems}`;
            robotText.textContent = levelData.introText;

            playRobot(levelData.introAudio);

            // Render Zones
            zonesRow.innerHTML = '';
            levelData.types.forEach(type => {
                const def = zoneDefinitions[type];
                const zone = document.createElement('div');
                zone.className = 'drop-zone';
                zone.dataset.accept = type;
                zone.innerHTML = `<div class="zone-title">${def.label}</div><img src="${def.icon}" class="zone-icon-img" alt="${def.label}">`;
                zone.addEventListener('dragover', dragOver);
                zone.addEventListener('dragleave', dragLeave);
                zone.addEventListener('drop', drop);
                zonesRow.appendChild(zone);
            });

            // Render Items
            itemsRow.innerHTML = '';
            const shuffledItems = [...levelData.items].sort(() => Math.random() - 0.5);
            shuffledItems.forEach(item => {
                const el = document.createElement('div');
                el.className = 'draggable';
                el.draggable = true;
                el.dataset.type = item.type;
                el.id = item.id;
                el.innerHTML = `<img src="${item.img}" alt="${item.name}"><span>${item.name}</span>`;
                el.addEventListener('dragstart', dragStart);
                el.addEventListener('dragend', dragEnd);
                el.addEventListener('touchstart', handleTouchStart, {passive: false});
                el.addEventListener('touchend', handleTouchEnd);
                itemsRow.appendChild(el);
            });
        }

        // Logic K√©o Th·∫£ & Touch
        let draggedItem = null;
        function dragStart() { draggedItem = this; setTimeout(() => this.style.opacity = '0.4', 0); }
        function dragEnd() { if(draggedItem) draggedItem.style.opacity = '1'; draggedItem = null; }
        function dragOver(e) { e.preventDefault(); this.classList.add('active-zone'); }
        function dragLeave() { this.classList.remove('active-zone'); }
        function drop(e) {
            e.preventDefault(); this.classList.remove('active-zone');
            if (!draggedItem) return;
            checkMatch(draggedItem.dataset.type, this.dataset.accept, draggedItem, this);
        }

        let touchItem = null;
        function handleTouchStart(e) { touchItem = this; }
        function handleTouchEnd(e) {
            if (!touchItem) return;
            const touch = e.changedTouches[0];
            touchItem.hidden = true;
            const elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            touchItem.hidden = false;
            const zone = elemBelow ? elemBelow.closest('.drop-zone') : null;
            if (zone) checkMatch(touchItem.dataset.type, zone.dataset.accept, touchItem, zone);
            touchItem = null;
        }

        function checkMatch(itemType, zoneType, itemElement, zoneElement) {
            if (itemType === zoneType) {
                playSound('correct');
                zoneElement.appendChild(itemElement);
                itemElement.draggable = false;
                itemElement.style.cursor = 'default';
                itemElement.style.transform = 'scale(0.8)';
                correctCount++;
                scoreIndicator.textContent = `Ti·∫øn ƒë·ªô: ${correctCount}/${totalItems}`;
                robotText.textContent = "Ch√≠nh x√°c! B√© gi·ªèi qu√°!";
                if (correctCount === totalItems) setTimeout(levelComplete, 500);
            } else {
                playSound('wrong');
                robotText.textContent = "Sai r·ªìi! Th·ª≠ l·∫°i nh√©!";
                itemElement.animate([{transform:'translateX(0)'}, {transform:'translateX(-10px)'}, {transform:'translateX(10px)'}, {transform:'translateX(0)'}], {duration:300});
            }
        }

        function levelComplete() {
            const levelData = gameData[currentLevelIndex];
            playRobot(levelData.successAudio);
            modalTitle.textContent = "M√†n ch∆°i ho√†n t·∫•t! üéâ";
            modalMsg.textContent = levelData.successText;
            
            if (currentLevelIndex < gameData.length - 1) {
                nextBtn.style.display = 'inline-block';
                nextBtn.textContent = "M√†n ti·∫øp theo ‚ûî";
                nextBtn.onclick = nextLevel;
            } else {
                nextBtn.style.display = 'inline-block';
                nextBtn.textContent = "Ch∆°i l·∫°i t·ª´ ƒë·∫ßu üèÅ";
                nextBtn.onclick = () => loadLevel(0);
                modalTitle.textContent = "CH√öC M·ª™NG CHI·∫æN TH·∫ÆNG!";
                modalMsg.textContent = "B√© ƒë√£ xu·∫•t s·∫Øc ho√†n th√†nh t·∫•t c·∫£ nhi·ªám v·ª•!";
            }
            modal.style.display = 'flex';
        }

        function restartLevel() { loadLevel(currentLevelIndex); }
        function nextLevel() { if(currentLevelIndex < gameData.length - 1) loadLevel(currentLevelIndex + 1); }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime+0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+0.5);
                osc.start(); osc.stop(audioCtx.currentTime+0.5);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime+0.2);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime+0.3);
                osc.start(); osc.stop(audioCtx.currentTime+0.3);
            }
        }
    </script>
</body>
</html>